// writeup: https://github.com/volticks/CTF-Writeups/tree/main/UIUCTF%2021/insecure-seccomp
// 題目 patch 掉 kernel, 讓一般使用者也可以使用 seccomp 的 filter mode (詳情請見 github/C 的 seccomp)
// 這題允許使用者自定義 seccomp rules
// 只要 /flag 不存在就開 shell  (但 /flag 必定存在)
// 解法:
// 設定 seccomp rules 讓 faccessat return 非 0

#include <assert.h>
#include <fcntl.h>
#include <stdio.h>
#include <unistd.h>

int main(int argc, char *argv[])
{
        if (!faccessat(AT_FDCWD, "/flag", R_OK, AT_EACCESS)) {
                fprintf(stderr, "You can't be root to execute this! ... or can you?\n");
                return 1;
        }

        setuid(geteuid());

        execl("/bin/sh", "sh", NULL);
        perror("execl");
        return 1;
}
